var Hapi = require('hapi');
var Good = require('./lib');

var server = new Hapi.Server();
server.connection({ host: 'localhost', port: 9001});

var goodOptions = {
    opsInterval: 1000,
    responseEvent: 'tail',
    reporters: [{
        reporter: require('good-console'),
        args: [{
            response: '*',
            error: '*',
            log: '*',
            request: '*'
        }]
    }]
};

server.route({
    method: 'get',
    path: '/',
    handler: function (request, reply) {

        reply();
    }
});

//server.ext('onRequest', function (request, reply) {
//
//    if (request.connection.info.protocol === 'http') {
//        return reply.redirect('https://' + request.headers.host + request.url.path).permanent();
//    }
//
//    reply.continue();
//});

server.on('request-internal', function (request, event, tags) {
   if (tags.received) {
       console.log('new request');
   }
});

server.ext('onRequest', function (request, reply) {

    console.log('onRequest');

   reply.continue();
});


server.register({
    register: Good,
    options: goodOptions
}, function (err) {

    if (err) {
        console.error(err);
    }
    else {
        server.start(function () {

            console.info('Server started at ' + server.info.uri);
        });
    }
});